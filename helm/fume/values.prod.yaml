# Production override values for fume.
# This file overrides the default values for production deployment.

# Disable frontend in production
enableFrontend: false

# Image pull secret (optional)
# If your cluster/namespace/service account does not already provide credentials to pull
# private images from Docker Hub, set the secret name here. Otherwise leave it unset
# and rely on cluster/namespace/service account level imagePullSecrets.
# image:
#   pullSecret: "dockerhub-secret"

# Backend configuration for production
backend:
  replicaCount: 3
  
  resources:
    limits:
      cpu: 2000m
      memory: 4Gi
    requests:
      cpu: 1000m
      memory: 2Gi

# Storage configuration for production
storage:
  templates:
    enabled: true
    # For multi-replica backends, templates storage must be RWX-capable (or run replicaCount=1).
    accessMode: ReadWriteMany
    size: 5Gi
    storageClass: "ssd"

  # Recommended for production: persistent shared package cache (also holds snapshot/terminology caches in v3)
  fhirCache:
    enabled: true
    accessMode: ReadWriteMany
    size: 100Gi
    storageClass: "ssd"

# Environment variables for production
env:
  FHIR_VERSION: "4.0.1"
  FHIR_SERVER_AUTH_TYPE: "BASIC"
  FUME_DESIGNER_HEADLINE: "FUME Designer - PRODUCTION"

# ConfigMap data for production - override defaults and set required values
configMap: {}
  # Override these at deploy time (none are set by default to force explicit configuration):
  # CANONICAL_BASE_URL: "https://fume.your-company.com"
  # FUME_SERVER_URL: "https://fume-api.production.com"
  # FHIR_PACKAGES: "hl7.fhir.r4.core@4.0.1,fhir.tx.support.r4"
  # FHIR_PACKAGE_REGISTRY_URL: "https://packages.your-company.com" # Optional

# Auto-scaling enabled for production
autoscaling:
  backend:
    enabled: true
    minReplicas: 3
    maxReplicas: 20
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 75

# Ingress configuration for production
ingress:
  enabled: true
  className: "nginx"
  annotations:
    kubernetes.io/tls-acme: "true"
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    nginx.ingress.kubernetes.io/rate-limit: "100"
  hosts:
    - host: fume.production.com
      paths:
        - path: /api
          pathType: Prefix
          service: backend
  tls:
    - secretName: fume-tls
      hosts:
        - fume.production.com
