##############################################
# CI override values for E2E tests
# These values tailor the chart for lightweight KinD validation while
# exercising the real FUME backend image, license mount, and fhirCache.
##############################################

enableFrontend: false

configMap:
  CANONICAL_BASE_URL: "https://fume.example.com"
  FUME_SERVER_URL: "https://api.example.com"
  # Ensure at least one package so we can assert cache population.
  FHIR_PACKAGES: "hl7.fhir.r4.core@4.0.1"

image:
  backend:
    # Use the real enterprise server image instead of nginx placeholder.
    repository: outburnltd/fume-enterprise-server
    # Keep tag aligned with Chart.appVersion unless explicitly testing upgrade scenarios.
    tag: "1.8.0"
  # frontend image unused (enableFrontend=false), retain defaults from parent values if referenced.
  pullPolicy: IfNotPresent
  # pullSecret will be injected at install time via --set image.pullSecret=regcred (created in workflow).

service:
  backend:
    port: 42420
    targetPort: 42420

backend:
  replicaCount: 1
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 200m
      memory: 256Mi

# CI-specific environment overrides
env:
  SERVER_STATELESS: "true"

probes:
  backend:
    # Probes disabled for CI to simplify timing; readiness validated via explicit HTTP checks in workflow.
    liveness:
      enabled: false
    readiness:
      enabled: false

storage:
  snapshots:
    enabled: false
    size: 1Gi
    accessMode: ReadWriteOnce
    storageClass: "standard"
  templates:
    enabled: false
    size: 1Gi
    accessMode: ReadWriteOnce
    storageClass: "standard"
  # Correct key name (was fhircache) â€“ intentionally disabled by default; workflow enables via --set.
  fhirCache:
    enabled: false
    size: 1Gi
    accessMode: ReadWriteOnce
    storageClass: "standard"
